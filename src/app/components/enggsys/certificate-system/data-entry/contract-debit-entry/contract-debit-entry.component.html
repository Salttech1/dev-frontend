<section>
  <div class="container">
    <form [formGroup]="contractDebitEntryForm">
      <div class="form_container">
        <div class="d-flex justify-content-center mb-2">
          <div class="col-sm-4 col-md-3 col-lg-2">
            <div
              class="input-group"
              [class.is-invalid]="
                contractDebitEntryForm.controls['debitType'].invalid &&
                contractDebitEntryForm.controls['debitType'].touched
              "
            >
              <span
                class="input-group-text leftform_lbl font500 text-dark1 font12"
                >Debit Type</span
              >
              <input
                type="text"
                class="form-control border-start-0"
                id="debitType123"
                maxlength="1"
                formControlName="debitType"
                [f1]="{ id: 'CONTDBRECTYPE', fill: 1 }"
              />
            </div>
            <div
              *ngIf="
                contractDebitEntryForm.controls['debitType'].invalid &&
                contractDebitEntryForm.controls['debitType'].touched
              "
            >
              <div
                class="errorField common_color_txt font12 font500"
                *ngIf=" contractDebitEntryForm.controls['debitType'].errors &&  contractDebitEntryForm.controls['debitType'].errors?.['required']"
              >
                Debit type is required
              </div>
            </div>
            <div
              class="invalid-feedback d-block"
              *ngIf="
                contractDebitEntryForm.controls['debitType'].invalid &&
                contractDebitEntryForm.controls['debitType'].touched
              "
            >
              <div
                *ngIf=" contractDebitEntryForm.controls['debitType'].errors?.['notFound']"
              >
                Invalid Debit type
              </div>
            </div>
          </div>
        </div>
        <div class="row g-2 mb-3 group_panel_padding" style="margin-top: 10px">
          <div class="col-lg-3 col-md-4 margin-left-100">
            <div
              class="input-group"
              [class.is-invalid]="
                contractDebitEntryForm.controls['recId'].invalid &&
                contractDebitEntryForm.controls['recId'].touched
              "
            >
              <span
                class="input-group-text leftform_lbl font500 text-dark1 font12"
                >Rec Id</span
              >
              <input
                type="text"
                class="form-control border-start-0"
                id="recId123"
                formControlName="recId"
                [f1]="{ id: 'CONTRACTID', fill: 1 }"
              />
            </div>
            <div
              *ngIf="
                contractDebitEntryForm.controls['recId'].invalid &&
                contractDebitEntryForm.controls['recId'].touched
              "
            >
              <div
                class="errorField common_color_txt font12 font500"
                *ngIf=" contractDebitEntryForm.controls['recId'].errors &&  contractDebitEntryForm.controls['recId'].errors?.['required']"
              >
                Rec Id is required
              </div>
            </div>
            <div
              class="invalid-feedback d-block"
              *ngIf="
                contractDebitEntryForm.controls['recId'].invalid &&
                contractDebitEntryForm.controls['recId'].touched
              "
            >
              <div
                *ngIf=" contractDebitEntryForm.controls['recId'].errors?.['notFound']"
              >
                Invalid Rec Id
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-4">
            <div
              class="input-group"
              [class.is-invalid]="
                contractDebitEntryForm.controls['certType'].invalid &&
                contractDebitEntryForm.controls['certType'].touched
              "
            >
              <span
                class="input-group-text leftform_lbl font500 text-dark1 font12"
                >Cert Type</span
              >
              <input
                type="text"
                class="form-control border-start-0"
                id="recId123"
                formControlName="certType"
                [f1]="{ id: 'CERTTYPES', fill: 1 }"
              />
            </div>
            <div
              *ngIf="
                contractDebitEntryForm.controls['certType'].invalid &&
                contractDebitEntryForm.controls['certType'].touched
              "
            >
              <div
                class="errorField common_color_txt font12 font500"
                *ngIf=" contractDebitEntryForm.controls['certType'].errors &&  contractDebitEntryForm.controls['certType'].errors?.['required']"
              >
                Cert Type is required
              </div>
            </div>
            <div
              class="invalid-feedback d-block"
              *ngIf="
                contractDebitEntryForm.controls['certType'].invalid &&
                contractDebitEntryForm.controls['certType'].touched
              "
            >
              <div
                *ngIf=" contractDebitEntryForm.controls['certType'].errors?.['notFound']"
              >
                Invalid Cert Type
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-4">
            <div
              class="input-group"
              [class.is-invalid]="
                contractDebitEntryForm.controls['runser'].invalid &&
                contractDebitEntryForm.controls['runser'].touched
              "
            >
              <span
                class="input-group-text leftform_lbl font500 text-dark1 font12"
                >Runser</span
              >
              <input
                type="text"
                class="form-control border-start-0"
                id="runser123"
                formControlName="runser"
                oninput="this.value=this.value.replace(/[^0-9\.]/g,'');"
              />
            </div>
            <div
              *ngIf="
                contractDebitEntryForm.controls['runser'].invalid &&
                contractDebitEntryForm.controls['runser'].touched
              "
            >
              <div
                class="errorField common_color_txt font12 font500"
                *ngIf=" contractDebitEntryForm.controls['runser'].errors &&  contractDebitEntryForm.controls['runser'].errors?.['required']"
              >
                Runser is required
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 margin-left-100">
            <div
              class="input-group"
              [class.is-invalid]="
                contractDebitEntryForm.controls['authnum'].invalid &&
                contractDebitEntryForm.controls['authnum'].touched
              "
            >
              <span
                class="input-group-text leftform_lbl font500 text-dark1 font12"
                >Auhthorisation No</span
              >
              <input
                type="text"
                class="form-control border-start-0"
                id="authnum123"
                formControlName="authnum"
                [f1]="{ id: 'AUTHNUM', fill: 1 }"
              />
            </div>
            <div
              *ngIf="
                contractDebitEntryForm.controls['authnum'].invalid &&
                contractDebitEntryForm.controls['authnum'].touched
              "
            >
              <div
                class="errorField common_color_txt font12 font500"
                *ngIf=" contractDebitEntryForm.controls['authnum'].errors &&  contractDebitEntryForm.controls['authnum'].errors?.['required']"
              >
                Authorisation No is required
              </div>
            </div>
            <div
              class="invalid-feedback d-block"
              *ngIf="
                contractDebitEntryForm.controls['authnum'].invalid &&
                contractDebitEntryForm.controls['authnum'].touched
              "
            >
              <div
                *ngIf=" contractDebitEntryForm.controls['authnum'].errors?.['notFound']"
              >
                Invalid Authorisation No
              </div>
            </div>
          </div>
          <div class="col-lg-8 col-md-8 margin-left-100">
            <div class="input-group">
              <span
                class="input-group-text leftform_lbl font500 text-dark1 font12"
                >Contractor</span
              >
              <input
                type="text"
                class="form-control post_input_field border-end-0 border-start-0 d-flex"
                formControlName="contractor"
                tabindex="-1"
                disabled
              />
              <span class="position-relative span_divider"></span>
              <input
                type="text"
                class="form-control border-start-0 post_input_field w-50 text-dark1 font12 font500"
                id
                formControlName="contractorName"
                tabindex="-1"
                disabled
              />
            </div>
          </div>

          <div class="col-lg-8 col-md-8 margin-left-100">
            <div
              class="input-group"
              [class.is-invalid]="
                contractDebitEntryForm.controls['bldgCode'].invalid &&
                contractDebitEntryForm.controls['bldgCode'].touched
              "
            >
              <span
                class="input-group-text leftform_lbl font500 text-dark1 font12"
                >Building Code</span
              >
              <input
                type="text"
                class="form-control border-start-0"
                id="bldgCode123"
                formControlName="bldgCode"
                [f1]="{ id: 'ENGGBUILDINGS' }"
              />
            </div>
            <div
              *ngIf="
                contractDebitEntryForm.controls['bldgCode'].invalid &&
                contractDebitEntryForm.controls['bldgCode'].touched
              "
            >
              <div
                class="errorField common_color_txt font12 font500"
                *ngIf=" contractDebitEntryForm.controls['bldgCode'].errors &&  contractDebitEntryForm.controls['bldgCode'].errors?.['required']"
              >
                Building is required
              </div>
            </div>
            <div
              class="invalid-feedback d-block"
              *ngIf="
                contractDebitEntryForm.controls['bldgCode'].invalid &&
                contractDebitEntryForm.controls['bldgCode'].touched
              "
            >
              <div
                *ngIf=" contractDebitEntryForm.controls['bldgCode'].errors?.['notFound']"
              >
                Invalid Building Code
              </div>
            </div>
          </div>
          <div class="col-lg-8 col-md-8 margin-left-100">
            <div class="input-group">
              <span
                class="input-group-text leftform_lbl font500 text-dark1 font12"
                >Company</span
              >
              <input
                type="text"
                class="form-control post_input_field border-end-0 border-start-0 d-flex"
                formControlName="coy"
                tabindex="-1"
                disabled
              />
              <span class="position-relative span_divider"></span>
              <input
                type="text"
                class="form-control border-start-0 post_input_field w-50 text-dark1 font12 font500"
                id
                formControlName="companyName"
                tabindex="-1"
                disabled
              />
            </div>
          </div>
        </div>
        <div
          *ngIf="isDataRecieved"
          class="tab-pane container active p-0"
          id="contractDebitDetails"
          formArrayName="contractDebitWiseArray"
        >
          <div class="gstBreakup_section">
            <div class="table-responsive">
              <div class="view">
                <div class="wrapper">
                  <table
                    class="table table-bordered datatable table w-100 mb-0"
                    [cellNavi]="'cell'"
                  >
                    <thead class="table_head_position_sticky">
                      <tr tabindex="0">
                        <th class="fontBold font12 text-dark1">Sr No.</th>
                        <th class="fontBold font12 text-dark1">Contra RecId</th>
                        <th class="fontBold font12 text-dark1">Debit Amount</th>
                        <th class="fontBold font12 text-dark1">Remarks</th>
                        <th class="fontBold font12 text-dark1">BldgCode</th>
                        <th class="fontBold font12 text-dark1">WorkCode</th>
                        <th class="fontBold font12 text-dark1">Party</th>
                        <th class="fontBold font12 text-dark1">Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr
                        *ngFor="
                          let item of contractDebitEntryForm.controls
                            .contractDebitWiseArray.controls;
                          let index = index
                        "
                        [formGroupName]="index"
                      >
                        <td>{{ index + 1 }}</td>
                        <td>
                          <div
                            class="input-group border border-light"
                            [class.is-invalid]="
                            contractDebitEntryForm.controls
                            .contractDebitWiseArray.controls[index]
                            .controls['contracontract'].invalid &&
                          contractDebitEntryForm.controls
                            .contractDebitWiseArray.controls[index]
                            .controls['contracontract'].touched
                            "
                          >
                            <input
                              class="border-0 form-control input_control form-control font500 text-dark1 font12"
                              type="text"
                              name
                              [id]="'cell' + index + '-1'"
                              [f1]="{
                                id: 'CONTRACTID',
                                fill: 1,
                                subId: contraRecIdCondiiton
                              }"
                              [formControlName]="'contracontract'"
                              (blur)="setBldgAndPartyAndWorkCode(index)"
                            />
                          </div>
                          <div
                            *ngIf="
                              contractDebitEntryForm.controls
                                .contractDebitWiseArray.controls[index]
                                .controls['contracontract'].invalid &&
                              contractDebitEntryForm.controls
                                .contractDebitWiseArray.controls[index]
                                .controls['contracontract'].touched
                            "
                          >
                            <div
                              class="errorField common_color_txt font12 font500"
                              *ngIf="  contractDebitEntryForm.controls
                .contractDebitWiseArray.controls[
                index
              ].controls['contracontract'].errors &&   contractDebitEntryForm.controls
              .contractDebitWiseArray.controls[
              index
            ].controls['contracontract'].errors?.['required']"
                            >
                             Contra Rec Id is required
                            </div>
                          </div>
                          <div
                            class="invalid-feedback d-block"
                            *ngIf="
                              contractDebitEntryForm.controls
                                .contractDebitWiseArray.controls[index]
                                .controls['contracontract'].invalid &&
                              contractDebitEntryForm.controls
                                .contractDebitWiseArray.controls[index]
                                .controls['contracontract'].touched
                            "
                          >
                            <div
                              *ngIf=" contractDebitEntryForm.controls
                .contractDebitWiseArray.controls[
                index
              ].controls['contracontract'].errors?.['contracontract']"
                            >
                              Invalid Rec Id
                            </div>
                          </div>
                        </td>
                        <td>
                          <div
                            class="input-group border border-light"
                            [class.is-invalid]="
                              contractDebitEntryForm.controls
                                .contractDebitWiseArray.controls[index]
                                .controls['debitamount'].invalid &&
                              contractDebitEntryForm.controls
                                .contractDebitWiseArray.controls[index]
                                .controls['debitamount'].touched
                            "
                          >
                            <input
                              class="border-0 form-control input_control form-control font500 text-dark1 font12 text-end"
                              type="text"
                              name
                              [id]="'cell' + index + '-2'"
                              (keyup)="calcTotalDebitAmount()"
                              oninput="this.value=this.value.replace(/[^0-9\.]/g,'');"
                              (blur)="setDebitAmount(index)"
                              [formControlName]="'debitamount'"
                            />
                          </div>
                          <div
                          *ngIf="
                            contractDebitEntryForm.controls
                              .contractDebitWiseArray.controls[index]
                              .controls['debitamount'].invalid &&
                            contractDebitEntryForm.controls
                              .contractDebitWiseArray.controls[index]
                              .controls['debitamount'].touched
                          "
                        >
                          <div
                            class="errorField common_color_txt font12 font500"
                            *ngIf="  contractDebitEntryForm.controls
              .contractDebitWiseArray.controls[
              index
            ].controls['debitamount'].errors &&   contractDebitEntryForm.controls
            .contractDebitWiseArray.controls[
            index
          ].controls['debitamount'].errors?.['required']"
                          >
                            Debit Amount is required 
                          </div>
                          <div  class="errorField common_color_txt font12 font500"  *ngIf="contractDebitEntryForm.controls
                          .contractDebitWiseArray.controls[
                          index
                        ].controls['debitamount'].errors?.['amtExceeds']">
                            Debit Amount should be greater than 0
                          </div>
                        </div>
                        </td>
                        <td>
                          <input
                            class="border-0 form-control input_control form-control font500 text-dark1 font12"
                            type="text"
                            name
                            maxlength="50"
                            [id]="'cell' + index + '-3'"
                            [formControlName]="'remarks'"
                          />
                        </td>
                        <td>
                          <input
                            class="border-0 form-control input_control form-control font500 text-dark1 font12 itemDesc_input"
                            type="text"
                            name
                            readonly
                            tabindex="-1"
                            [formControlName]="'bldgcode'"
                          />
                        </td>
                        <td>
                          <input
                            class="border-0 form-control input_control form-control font500 text-dark1 font12 itemDesc_input"
                            type="text"
                            name
                            readonly
                            tabindex="-1"
                            [formControlName]="'workCode'"
                          />
                        </td>

                        <td>
                          <input
                            class="border-0 form-control input_control form-control font500 text-dark1 font12 itemDesc_input"
                            type="text"
                            name
                            readonly
                            tabindex="-1"
                            [formControlName]="'partyCode'"
                          />
                        </td>
                        <td>
                          <div
                            class="action_panel d-flex justify-content-center"
                          >
                            <button
                              type="button"
                              class="border-0 bg-transparent ms-1 btn p-0 m-0 lh_0"
                              (click)="deleteRow($event,index)"
                            >
                            <img
                            src="assets/images/delete.svg"
                            alt="remove"
                            class="delete_img"
                        >
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-3 col-md-4 col-lg-3" *ngIf="isDataRecieved">
          <div class="input-group margin-top-30">
            <span
              class="input-group-text leftform_lbl font500 text-dark1 font12"
              >Total Amount</span
            >
            <input
              type="text"
              class="form-control border-start-0"
              id="totAmnte123"
              formControlName="totalAmount"
              disabled="true"
            />
          </div>
        </div>
      </div>
    </form>
  </div>
</section>

<section class="action_section position-fixed w-100">
  <div class="container">
    <div class="action_conatiner bg-white br-10 d-flex justify-content-center">
      <button
        type="submit"
        [disabled]="disableButtonFlags[0]"
        class="bg_common_red common_action_btn br-10"
        [attr.accesskey]="loaderToggle ? '' : 'a'"
        (click)="handleAddClick()"
      >
        Add
      </button>
      <button
        type="submit"
        [disabled]="disableButtonFlags[1]"
        class="bg_common_red common_action_btn br-10"
        [attr.accesskey]="loaderToggle ? '' : 'r'"
        (click)="checkIsContractDebitAuthorised()"
      >
        Retrieve
      </button>
      <button
        type="submit"
        [disabled]="disableReverse"
        class="bg_common_red common_action_btn br-10 first_letter_textdecorationone"
        [attr.accesskey]="loaderToggle ? '' : 'v'"
        (click)="checkIsContractDebitAuthorised()"
      >
        Re<span class="text-decoration-underline">v</span>erse
      </button>
      <button
        type="submit"
        [disabled]="disableButtonFlags[2]"
        class="bg_common_red common_action_btn br-10"
        accesskey="s"
        [attr.accesskey]="loaderToggle ? '' : 's'"
        (click)="save()"
      >
        Save
      </button>
      <button
        type="submit"
        [disabled]="disableButtonFlags[3]"
        class="bg_common_red border-0 common_action_btn text-white br-10 ms-1 first_letter_textdecorationone"
        [attr.accesskey]="loaderToggle ? '' : 'o'"
        (click)="addRow()"
      >
      Add_R<span class="text-decoration-underline">o</span>w
      </button>
      <button
        type="submit"
        [disabled]="disableButtonFlags[4]"
        [attr.accesskey]="loaderToggle ? '' : 'b'"
        class="bg_common_red common_action_btn br-10"
        accesskey="b"
        (click)="back()"
      >
        Back
      </button>
      <a
      class="bg_common_red border-0 common_action_btn text-white br-10 first_letter_textdecorationone text-decoration-none"
      accesskey="x"
      routerLink="/dashboard"
      *ngIf="!disableButtonFlags[5]"
    >
      E<u>x</u>it
    </a>
    </div>
  </div>
</section>
<app-loader *ngIf="loaderToggle"></app-loader>
